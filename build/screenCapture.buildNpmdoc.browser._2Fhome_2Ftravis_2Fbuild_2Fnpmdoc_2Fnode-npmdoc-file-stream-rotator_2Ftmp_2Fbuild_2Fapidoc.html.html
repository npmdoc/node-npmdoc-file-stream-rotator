<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="https://github.com/holidayextras/file-stream-rotator#readme">file-stream-rotator (v0.1.0)</a>
</h1>
<h4>Automated stream rotation</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.file-stream-rotator">module file-stream-rotator</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.file-stream-rotator.getDate">
            function <span class="apidocSignatureSpan">file-stream-rotator.</span>getDate
            <span class="apidocSignatureSpan">(format, date_format)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.file-stream-rotator.getFrequency">
            function <span class="apidocSignatureSpan">file-stream-rotator.</span>getFrequency
            <span class="apidocSignatureSpan">(frequency)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.file-stream-rotator.getStream">
            function <span class="apidocSignatureSpan">file-stream-rotator.</span>getStream
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.file-stream-rotator.parseFileSize">
            function <span class="apidocSignatureSpan">file-stream-rotator.</span>parseFileSize
            <span class="apidocSignatureSpan">(size)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.file-stream-rotator" id="apidoc.module.file-stream-rotator">module file-stream-rotator</a></h1>


    <h2>
        <a href="#apidoc.element.file-stream-rotator.getDate" id="apidoc.element.file-stream-rotator.getDate">
        function <span class="apidocSignatureSpan">file-stream-rotator.</span>getDate
        <span class="apidocSignatureSpan">(format, date_format)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getDate = function (format, date_format) {
    date_format = date_format || DATE_FORMAT;
    if (format &amp;&amp; staticFrequency.indexOf(format.type) !== -1) {
        switch (format.type) {
            case 'm':
                var minute = Math.floor(moment().minutes() / format.digit) * format.digit;
                return moment().minutes(minute).format(date_format);
                break;
            case 'h':
                var hour = Math.floor(moment().hour() / format.digit) * format.digit;
                return moment().hour(hour).format(date_format);
                break;
            case 'daily':
            case 'custom':
            case 'test':
                return moment().format(date_format);
        }
    }
    return moment().format(date_format);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    if(moment().format(dateFormat) != moment().add(2,"hours").format(dateFormat) || moment().format(dateFormat) == moment
().add(1,"day").format(dateFormat)){
        console.log("Changing type to custom as date format changes more often than once a day or not every day");
        frequencyMetaData.type = "custom";
    }
}

if (frequencyMetaData) {
    curDate = (options.frequency ? self.<span class="apidocCodeKeywordSpan">getDate</span>(frequencyMetaData,dateFormat) : "
;");
}

var filename = options.filename;
var oldFile = null;
var logfile = filename + (curDate ? "." + curDate : "");
if(filename.match(/%DATE%/)){
    logfile = filename.replace(/%DATE%/g,(curDate?curDate:self.getDate(null,dateFormat)));
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.file-stream-rotator.getFrequency" id="apidoc.element.file-stream-rotator.getFrequency">
        function <span class="apidocSignatureSpan">file-stream-rotator.</span>getFrequency
        <span class="apidocSignatureSpan">(frequency)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getFrequency = function (frequency) {
    var _f = frequency.toLowerCase().match(/^(\d+)([m|h])$/)
    if(_f){
        return _checkNumAndType(_f[2], parseInt(_f[1]));
    }

    var dailyOrTest = _checkDailyAndTest(frequency);
    if (dailyOrTest) {
        return dailyOrTest;
    }

    return false;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

if (!options.filename) {
    console.error("No filename supplied. Defaulting to STDOUT");
    return process.stdout;
}

if (options.frequency) {
    frequencyMetaData = self.<span class="apidocCodeKeywordSpan">getFrequency</span>(options.frequency);
}

var fileSize = null;
var fileCount = 0;
var curSize = 0;
if(options.size){
    fileSize = FileStreamRotator.parseFileSize(options.size);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.file-stream-rotator.getStream" id="apidoc.element.file-stream-rotator.getStream">
        function <span class="apidocSignatureSpan">file-stream-rotator.</span>getStream
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getStream = function (options) {
    var frequencyMetaData = null;
    var curDate = null;
    var self = this;

    if (!options.filename) {
        console.error("No filename supplied. Defaulting to STDOUT");
        return process.stdout;
    }

    if (options.frequency) {
        frequencyMetaData = self.getFrequency(options.frequency);
    }

    var fileSize = null;
    var fileCount = 0;
    var curSize = 0;
    if(options.size){
        fileSize = FileStreamRotator.parseFileSize(options.size);
    }

    var dateFormat = (options.date_format || DATE_FORMAT);
    if(frequencyMetaData &amp;&amp; frequencyMetaData.type == "daily"){
        if(!options.date_format){
            dateFormat = "YYYY-MM-DD";
        }
        if(moment().format(dateFormat) != moment().add(2,"hours").format(dateFormat) || moment().format(dateFormat) == moment().
add(1,"day").format(dateFormat)){
            console.log("Changing type to custom as date format changes more often than once a day or not every day");
            frequencyMetaData.type = "custom";
        }
    }

    if (frequencyMetaData) {
        curDate = (options.frequency ? self.getDate(frequencyMetaData,dateFormat) : "");
    }

    var filename = options.filename;
    var oldFile = null;
    var logfile = filename + (curDate ? "." + curDate : "");
    if(filename.match(/%DATE%/)){
        logfile = filename.replace(/%DATE%/g,(curDate?curDate:self.getDate(null,dateFormat)));
    }
    var verbose = (options.verbose !== undefined ? options.verbose : true);
    if (verbose) {
        console.log("Logging to", logfile);
    }

    if(fileSize){
        var t_log = logfile;
        var f = null;
        while(f = fs.existsSync(t_log)){
            fileCount++;
            t_log = logfile + "." + fileCount;
        }
        logfile = t_log;
    }

    mkDirForFile(logfile);

    var rotateStream = fs.createWriteStream(logfile, {flags: 'a'});
    if (curDate &amp;&amp; frequencyMetaData &amp;&amp; (staticFrequency.indexOf(frequencyMetaData.type) &gt; -1)) {
        if (verbose) {
            console.log("Rotating file", frequencyMetaData.type);
        }
        var stream = new EventEmitter();
        stream.end = function(){
            rotateStream.end.apply(rotateStream,arguments);
        };
        BubbleEvents(rotateStream,stream);

        stream.write = (function (str, encoding) {
            var newDate = this.getDate(frequencyMetaData,dateFormat);
            if (newDate != curDate || (fileSize &amp;&amp; curSize &gt; fileSize)) {
                var newLogfile = filename + (curDate ? "." + newDate : "");
                if(filename.match(/%DATE%/) &amp;&amp; curDate){
                    newLogfile = filename.replace(/%DATE%/g,newDate);
                }

                if(fileSize &amp;&amp; curSize &gt; fileSize){
                    fileCount++;
                    newLogfile += "." + fileCount;
                }else{
                    // reset file count
                    fileCount = 0;
                }
                curSize = 0;

                if (verbose) {
                    console.log("Changing logs from %s to %s", logfile, newLogfile);
                }
                curDate = newDate;
                oldFile = logfile;
                logfile = newLogfile;
                rotateStream.destroy();

                mkDirForFile(logfile);

                rotateStream = fs.createWriteStream(newLogfile, {flags: 'a'});
                stream.emit('new',newLogfile);
                stream.emit('rotate',oldFile, newLogfile);
                BubbleEvents(rotateStream,stream);
            }
            rotateStream.write(str, encoding);
            curSize += str.length
        }).bind(this);
        process.nextTick(function(){
            stream.emit('new',logfile);
        })
        return stream;
    } else {
        if (verbose) {
            console.log("File won't be rotated", options.frequency, frequencyMetaData &amp;&amp; frequencyMetaData.type);
        }
        process.nextTick(function(){
            rotateStream.emit('new',logfile);
        })
        return rotateStream;
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 *   - `filename`   Filename including full path used by the stream
 *   - `frequency`  How often to rotate. At present only 'daily' and 'test' are available. 'test'
rotates every minute.
 *                  If frequency is set to none of the above, a YYYYMMDD string will be added to the end of the filename.
 *   - `verbose`    If set, it will log to STDOUT when it rotates files and name of log file. Default is TRUE.
 *
 * To use with Express / Connect, use as below.
 *
 * var rotatingLogStream = require('FileStreamRotator').<span class="apidocCodeKeywordSpan">getStream</span>({filename
:"/tmp/test.log", frequency:"daily", verbose: false})
 * app.use(express.logger({stream: rotatingLogStream, format: "default"}));
 *
 * @param {Object} options
 * @return {Object}
 * @api public
 */
var FileStreamRotator = {};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.file-stream-rotator.parseFileSize" id="apidoc.element.file-stream-rotator.parseFileSize">
        function <span class="apidocSignatureSpan">file-stream-rotator.</span>parseFileSize
        <span class="apidocSignatureSpan">(size)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">parseFileSize = function (size) {
    if(size &amp;&amp; typeof size == "string"){
        var _s = size.toLowerCase().match(/^((?:0\.)?\d+)([k|m|g])$/);
        if(_s){
            switch(_s[2]){
                case 'k':
                    return _s[1]*1024
                case 'm':
                    return _s[1]*1024*1024
                case 'g':
                    return _s[1]*1024*1024*1024
            }
        }
    }
    return null;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    frequencyMetaData = self.getFrequency(options.frequency);
}

var fileSize = null;
var fileCount = 0;
var curSize = 0;
if(options.size){
    fileSize = FileStreamRotator.<span class="apidocCodeKeywordSpan">parseFileSize</span>(options.size);
}

var dateFormat = (options.date_format || DATE_FORMAT);
if(frequencyMetaData &amp;&amp; frequencyMetaData.type == "daily"){
    if(!options.date_format){
        dateFormat = "YYYY-MM-DD";
    }
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>